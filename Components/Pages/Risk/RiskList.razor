@using CyberRiskTracker.Models
@using CyberRiskTracker.Services
@inject NavigationManager NavigationManager
@inject RiskService RiskSvc
@inject TestApplicationState TestAppState
@rendermode InteractiveServer
@page "/risks"
@attribute [StreamRendering(true)]

<h3>Cyber Security Risks</h3>
@if (risks == null)
{
    <label>Loading...</label>
}
else if (risks.Count == 0)
{
    <label>No data found.</label>
}
else
{
    <div class="row">
        <div class="col-sm-4">Test String</div>
        <div class="col-sm-8">@TestAppState.TestString</div>

        <div class="col-sm-4">Test Integer</div>
        <div class="col-sm-8">@TestAppState.TestInt</div>
    </div>
    <RiskViewDialog RiskModel="_selectedRisk" SpecialRiskEventClicked="@SpecialRiskEventClicked" OnClose="@ClearRiskModel" />
    <StyledBox BackgroundColor="lavender" TextColor="darkslategray" SectionTitle="Cyber Security Risks">
        <div class="list-group">
            @foreach (var risk in risks)
            {
                <ErrorBoundary>
                    <ChildContent>
                        <div class="list-group-item d-flex align-items-center justify-content-between @(GetActiveClass(risk))">
                            <div class="d-flex align-items-center" style="gap: 10px;">
                                <img src="@risk.ImageFullPath" width="50" style="cursor:pointer" @onclick="() => GoToDetail(risk.Id)" alt="@risk.Title" />
                                <a href="@($"risk/{risk.Id}")" class="text-decoration-none fs-5">
                                    @risk.Title
                                </a>
                            </div>
                            <button @onclick="() => OpenRiskDialog(risk)" class="btn btn-outline-info btn-sm">
                                View
                            </button>
                        </div>
                    </ChildContent>
                    <ErrorContent>
                        <div class="border p-4 text-danger">
                            Sorry, something went wrong.
                        </div>
                    </ErrorContent>
                </ErrorBoundary>
            }
        </div>
    </StyledBox>
    <br />

    <StyledBox BackgroundColor="lightgray" TextColor="green" SectionTitle="Application Test State Display">
        <TestStateDisplay />
    </StyledBox>

}
